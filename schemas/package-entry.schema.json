{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://registry.openblock.cc/schemas/package-entry.schema.json",
    "title": "OpenBlock Package Entry",
    "description": "Schema for package entries in OpenBlock Registry packages.json",
    "definitions": {
        "versionEntry": {
            "type": "object",
            "required": ["version", "releaseDate", "downloadUrl", "sha256", "size"],
            "properties": {
                "version": {
                    "type": "string",
                    "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
                    "description": "Semantic version string"
                },
                "releaseDate": {
                    "type": "string",
                    "format": "date",
                    "description": "Release date in ISO 8601 format"
                },
                "downloadUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to download the package zip"
                },
                "sha256": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$",
                    "description": "SHA256 hash of the package zip"
                },
                "size": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Size of the package in bytes"
                }
            }
        },
        "platformEntry": {
            "type": "object",
            "required": ["downloadUrl", "sha256", "size"],
            "properties": {
                "downloadUrl": {
                    "type": "string",
                    "format": "uri"
                },
                "sha256": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                },
                "size": {
                    "type": "integer",
                    "minimum": 0
                }
            }
        },
        "toolchainVersionEntry": {
            "type": "object",
            "required": ["version", "releaseDate", "platforms"],
            "properties": {
                "version": {
                    "type": "string",
                    "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
                },
                "releaseDate": {
                    "type": "string",
                    "format": "date"
                },
                "platforms": {
                    "type": "object",
                    "properties": {
                        "win32": { "$ref": "#/definitions/platformEntry" },
                        "darwin": { "$ref": "#/definitions/platformEntry" },
                        "linux": { "$ref": "#/definitions/platformEntry" }
                    },
                    "additionalProperties": false
                }
            }
        },
        "openblockConfig": {
            "type": "object",
            "required": ["type"],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": ["device", "extension", "library", "toolchain"]
                },
                "iconURL": { "type": "string" },
                "tags": {
                    "type": "array",
                    "items": { "type": "string" }
                },
                "supportDevices": {
                    "type": "array",
                    "items": { "type": "string" }
                },
                "dependencies": {
                    "type": "object",
                    "properties": {
                        "libraries": {
                            "type": "object",
                            "additionalProperties": { "type": "string" }
                        },
                        "toolchains": {
                            "type": "object",
                            "additionalProperties": { "type": "string" }
                        }
                    }
                }
            }
        },
        "basePackage": {
            "type": "object",
            "required": ["id", "name", "description", "author", "license", "repository", "versions"],
            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-zA-Z][a-zA-Z0-9-]*$",
                    "description": "Unique package identifier"
                },
                "name": { "type": "string" },
                "description": { "type": "string" },
                "author": { "type": "string" },
                "license": { "type": "string" },
                "repository": {
                    "type": "string",
                    "format": "uri"
                },
                "openblock": { "$ref": "#/definitions/openblockConfig" }
            }
        },
        "devicePackage": {
            "allOf": [
                { "$ref": "#/definitions/basePackage" },
                {
                    "properties": {
                        "versions": {
                            "type": "array",
                            "items": { "$ref": "#/definitions/versionEntry" }
                        }
                    }
                }
            ]
        },
        "extensionPackage": {
            "allOf": [
                { "$ref": "#/definitions/basePackage" },
                {
                    "properties": {
                        "versions": {
                            "type": "array",
                            "items": { "$ref": "#/definitions/versionEntry" }
                        }
                    }
                }
            ]
        },
        "libraryPackage": {
            "allOf": [
                { "$ref": "#/definitions/basePackage" },
                {
                    "properties": {
                        "versions": {
                            "type": "array",
                            "items": { "$ref": "#/definitions/versionEntry" }
                        }
                    }
                }
            ]
        },
        "toolchainPackage": {
            "type": "object",
            "required": ["id", "name", "description", "upstream", "maintainer", "versions"],
            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-zA-Z][a-zA-Z0-9-]*$"
                },
                "name": { "type": "string" },
                "description": { "type": "string" },
                "upstream": { "type": "string", "format": "uri" },
                "maintainer": { "type": "string" },
                "versions": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/toolchainVersionEntry" }
                }
            }
        }
    }
}

