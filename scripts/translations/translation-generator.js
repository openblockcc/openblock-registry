/**
 * Translation Generator Module
 * Parse and generate translations.js files
 */

/**
 * Parse translations.js file content
 * @param {string} content - File content
 * @returns {object} Parsed result with header and translations
 */
export const parseTranslationsJs = function (content) {
    // Extract header (everything before 'export default')
    const headerMatch = content.match(/([\s\S]*?)export\s+default\s+/);
    const header = headerMatch ? headerMatch[1] : '';

    // Extract translation object
    const match = content.match(/export\s+default\s+(\{[\s\S]*\});?\s*$/);
    if (match) {
        // Replace single quotes with double quotes for JSON parsing
        const jsonStr = match[1].replace(/'/g, '"');
        const translations = JSON.parse(jsonStr);
        return {header, translations};
    }
    throw new Error('Failed to parse translations.js - unsupported format');
};

/**
 * Generate translations.js file content
 * Preserves the original file header and structure
 * @param {object} translations - Translation object
 * @param {string} originalHeader - Original file header (optional)
 * @returns {string} File content
 */
export const generateTranslationsJs = function (translations, originalHeader = null) {
    // Use original header if provided, otherwise use default
    const header = originalHeader || `/* eslint-disable quote-props */
/* eslint-disable max-len */
/**
 * Translation file for this resource.
 *
 * This file is generated by combining automatic extraction and manual translations:
 * - The "en" (English) section is automatically extracted from source files
 * - Other language sections can be manually translated or pulled from Transifex
 * - When regenerating, existing manual translations are preserved when the English
 *   source text hasn't changed
 *
 * Structure:
 * - interface: translations for name/description (used by GUI formatMessage)
 * - extensions: translations for extension blocks (used by VM formatMessage)
 * - blocks: translations for Blockly blocks (used by Blockly.Msg)
 */
`;

    // Format with single quotes and proper indentation
    const formatted = JSON.stringify(translations, null, 4).replace(/"/g, "'");

    return `${header}export default ${formatted};
`;
};

export default {
    parseTranslationsJs,
    generateTranslationsJs
};
